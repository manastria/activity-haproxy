---
title: "Configuration du Proxy Cache DNS"
description: "Guide pour configurer le service de proxy cache DNS sur un pare-feu Stormshield SNS, y compris les serveurs amont et le mode transparent."
---

import { Card, Steps, Aside, TabItem, Tabs } from '@astrojs/starlight/components';

<Card title="üéØ Objectif">
Configurer le pare-feu Stormshield SNS pour qu'il agisse comme un serveur DNS cache pour les clients du r√©seau local. Cela permet d'optimiser et de contr√¥ler les requ√™tes de r√©solution de noms de domaine.
</Card>

## Comprendre le Proxy DNS

Le service de **Proxy Cache DNS** sur un pare-feu SNS intercepte les requ√™tes DNS des clients du r√©seau. Il r√©pond directement si la r√©solution est dans son cache, sinon, il transmet la requ√™te √† des serveurs DNS externes, dits ¬´¬†amont¬†¬ª.

**Principaux avantages :**
* **Performance :** Acc√©l√®re la r√©solution de noms pour les domaines fr√©quemment consult√©s.
* **Contr√¥le :** Permet de centraliser les flux DNS et d'appliquer des politiques de s√©curit√©.
* **Simplification :** Les clients n'ont besoin de conna√Ætre que l'adresse du pare-feu pour leurs requ√™tes DNS.

---

## 1. Configurer les Serveurs DNS Amont

Les **serveurs DNS amont** sont les serveurs DNS publics (comme ceux de Google, Cloudflare, de votre FAI, de votre salle de formation) que le pare-feu consultera pour r√©soudre les noms de domaine qu'il ne conna√Æt pas. C'est une √©tape essentielle car le proxy a besoin d'une source fiable pour obtenir les informations.

<Steps>
1.  **Acc√©der aux Param√®tres R√©seau**
    Rendez-vous dans le menu `Configuration > Syst√®me > Configuration`.

2.  **Ouvrir l'onglet Param√®tres R√©seaux**
    S√©lectionnez l'onglet `PARAM√àTRES R√âSEAUX`.

3.  **Ajouter les Serveurs DNS**
    Dans la section **R√©solution DNS**, vous verrez la `LISTE DES SERVEURS DNS UTILIS√âS PAR LE FIREWALL`.
    * Cliquez sur `+ Ajouter` pour ins√©rer un nouveau serveur DNS.
    * Vous pouvez utiliser des serveurs connus comme `1.1.1.1` (Cloudflare) ou `8.8.8.8` (Google).

    <Aside type="tip">
    Il est recommand√© de configurer au moins deux serveurs DNS amont pour des raisons de redondance.
    </Aside>

4.  **Appliquer la Configuration**
    Cliquez sur le bouton **`Appliquer`** pour sauvegarder les modifications. Le pare-feu sait maintenant qui contacter pour r√©soudre les noms de domaine.
</Steps>

---

## 2. Activer le Proxy Cache DNS (Mode Transparent)

Le **mode transparent** signifie que vous n'avez pas besoin de modifier la configuration DNS sur chaque poste client pour qu'ils utilisent le proxy. Le pare-feu intercepte automatiquement les requ√™tes DNS (g√©n√©ralement sur le port 53) qui traversent ses interfaces et y r√©pond, sans que le client ne s'en aper√ßoive.

<Steps>
1.  **Acc√©der au Menu du Proxy DNS**
    Rendez-vous dans `Configuration > R√©seau > Proxy cache DNS`.

2.  **Activer le Service**
    Cliquez sur le bouton `OFF` pour le faire passer √† **`ON`**. Le service est maintenant actif et pr√™t √† intercepter les requ√™tes.

3.  **Autoriser les Clients √† Utiliser le Cache**
    Le proxy n'accepte pas les requ√™tes de n'importe qui. Vous devez explicitement d√©finir quelles machines ou r√©seaux sont autoris√©s √† l'utiliser.
    * Dans la section `LISTE DES CLIENTS AUTORIS√âS √Ä UTILISER LE CACHE DNS`, cliquez sur **`+ Ajouter`**.
    * S√©lectionnez l'objet r√©seau correspondant aux machines qui feront des requ√™tes. Par exemple, pour autoriser un serveur DNS interne de la DMZ, vous pouvez ajouter l'objet `srv_dns_priv`. Pour autoriser tout un r√©seau, vous pouvez s√©lectionner un objet comme `Network_in`.

4.  **Appliquer et Sauvegarder**
    Cliquez sur **`Appliquer`** pour sauvegarder la liste des clients autoris√©s.
</Steps>

## ‚úÖ R√©sum√© du Fonctionnement Transparent

<Tabs>
<TabItem label="√âtape 1 : Le Client">
Un poste client (ex: 192.168.1.100) configur√© pour utiliser un DNS externe (ex: 8.8.8.8) envoie une requ√™te pour `www.google.com`.
</TabItem>
<TabItem label="√âtape 2 : Le Pare-feu">
Le pare-feu voit passer cette requ√™te DNS (port 53). Comme son proxy DNS est en mode transparent, il l'intercepte.
</TabItem>
<TabItem label="√âtape 3 : La R√©ponse">
- **Si l'adresse est en cache :** Le pare-feu r√©pond imm√©diatement au client.
- **Si l'adresse n'est pas en cache :** Le pare-feu envoie la requ√™te √† ses propres serveurs DNS amont (ex: 1.1.1.1), re√ßoit la r√©ponse, la met en cache, et la transmet au client.
</TabItem>
</Tabs>

<Aside type="tip" title="Succ√®s" icon="approve-check">
**R√©sultat :** Le client re√ßoit sa r√©ponse DNS sans jamais savoir que c'est le pare-feu qui a trait√© sa demande √† la place du serveur DNS qu'il visait initialement.
</Aside>
